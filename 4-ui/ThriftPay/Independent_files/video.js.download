var VideoTheoplayer=function(l){"use strict";function g(e,t){if(null==e)return{};for(var n,o={},r=Object.keys(e),i=0;i<r.length;i++)n=r[i],0<=t.indexOf(n)||(o[n]=e[n]);return o}function a(e){var t=e.targetId,e=g(e,o);if("undefined"==typeof AGNO)throw new Error("agnoplay: AGNO not loaded");if(-1<v.indexOf(t))return AGNO.updatePlayerConfig(t,e);var n=document.getElementById(t);if(null===n)throw new Error("agnoplay: #"+t+" missing");v.push(t),u("Inserting videoplayer with targetId: "+t+"."),AGNO.insertPlayer(e,n)}function d(e){var t=e.allowNativeFullscreen,n=e.targetId,o=e.autoplay,r=e.brand,i=void 0===(i=e.url)?window.location.href:i,a=void 0===(a=e.socialUrl)?window.location.href:a,e=e.noads;return Object.assign({allowNativeFullscreen:void 0!==t&&t,brand:r,autoplay:o,targetId:n,url:i,noads:e},a&&a.includes("http")?{socialUrl:a}:{},o&&f?{mute_on_autoplay:!0}:{})}function t(e){var t,n,o,r,i,a,d,l,c,s,u,p,f,h=e.node,m=e.isTheoplayer,v=g(e,y);return m?(n="true"===(t=h.querySelector("."+I)).getAttribute("data-video-allow-native-fullscreen"),o=t.getAttribute("data-video-brand"),r=t.getAttribute("data-video-embed-id"),i=t.getAttribute("data-has-recommendations"),a=t.getAttribute("data-recommendations-account-id"),d=t.getAttribute("data-recommendations-playlist-id"),l=t.getAttribute("data-source"),c=t.getAttribute("data-title"),s=t.getAttribute("data-thumbnail"),u=t.getAttribute("data-video-live-id"),p="false"===t.getAttribute("data-video-prerolls"),f=o.split("-")[0],f=window.location.href&&-1<window.location.href.indexOf("http")?window.location.href:A[f],Object.assign({node:h,isTheoplayer:m},v,{allowNativeFullscreen:n,brand:o,targetId:t.id,videoId:r,hasRecommendations:i,accountId:a,playlistId:d,source:l,title:c,thumbnail:s,liveVideoId:u,noads:p,url:f,socialUrl:f})):e}function r(n){return new Promise(function(t){window.gdprConsents?t(window.gdprConsents):i.subscribe("GDPR/loaded",function(e){e=e.mhConsents;t(e)})}).then(function(e){var t=e&&e.contentPersonalization&&e.advertisingPersonalization&&e.cookies&&e.analytics,e=e&&e.cookies&&e.createContentProfile&&e.selectPersonalizedContent;return t||e?fetch(""+n+(n.slice(-1),"")+"videos/9").then(function(e){return u("Froomle recommendations response was successful."),e.json()}).then(function(e){var t=e.result,o=e.id;return t&&8<t.length?t.map(function(e){var t=e.articleId,n=e.title,e=e.image.src;return{link:window.location.origin+"/cnt/"+t+"?froomlerequestid="+o,title:n,image:e}}):[]}).catch(function(e){return u("Error while loading the Froomle recommendations.","error",e),[]}):[]})}var e="undefined"!=typeof window&&window.MEDIAHUIS||{},c=e.config||{},i=e.pubsub,s=e.ads||{},u=function(e,t,n){var o;void 0===t&&(t="info"),void 0===n&&(n=""),c&&"production"!==c.environment&&function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n+=1){var o=t[n].split("=");if(o[0]===e)return"true"===o[1]}return!1}("debug-video")&&(o={debug:"debug",error:"error",info:"info",log:"log"},console[o[t]&&t||o.info]("VIDEOPLAYER: "+e,n))},n=null,p=function(e,t){var o;return n||(o=e+"?v="+t,n=new Promise(function(e,t){var n=document.createElement("script");n.src=o,n.async=!0,n.onload=e,n.onerror=t,document.body.appendChild(n)}).then(function(e){return u("Loaded script from "+o),e}).catch(function(e){u("Error while loading script from "+o,"error",e)})),n},e=c.paper,f=["nbo","gva","hbvl","dso"].includes(e),o=["targetId"],h=["videoId","adTag"],m=["source","thumbnail","title"],v=[],b=function(e){var t=e.videoId,n=e.adTag,n=void 0===n?null:n,e=g(e,h);i=t,o=[],(n=n)&&(r=-1<n.indexOf("?")?"&":"?",o.push({integration:"google-ima",sources:n+r+"vid="+i}));var o,r,i=Object.assign({videoId:t,ads:o},d(e),(n=(n=e).related,(r={recommendations:9<=(n=void 0===n?[]:n).length}).recommendations&&(r.related=n),r));a(i)},w=function(e){e.source,e.thumbnail,e.title;e=g(e,m),e=Object.assign({url:"",noads:"true",videoId:e.brand},d(e));a(e)},y=(l.CDN_PREVIEW="https://player-acc.agnoplay.com",l.CDN_PRODUCTION="https://player.agnoplay.com",l.AGNOPLAY_PATH="/static/agnoplay/js/agnoplay.js",["node","isTheoplayer"]),I="js-theoplayer-placeholder",A={gva:"https://gva.be/",dso:"https://standaard.be/",nbo:"https://nieuwsblad.be/",hbvl:"https://hbvl.be/"},P=function(){var e=[].slice.call(document.querySelectorAll(".video")).map(function(e,t){var n=e.getAttribute("data-index");return{node:e,isTheoplayer:!!e.querySelector("."+I),indexOnPage:null!==n?Number(n):t}}).map(t);return u("Detecting videoplayer nodes on page. "+e.length+" nodes found."),e.length?e:[].slice.call(document.querySelectorAll("."+I)).map(function(e,t){var n=e.getAttribute("data-index");return{node:e.parentNode,isTheoplayer:!0,indexOnPage:null!==n?Number(n):t}}).map(t)},O="function"==typeof fetch,E=c.froomleServiceUrl,T=function(e){var t=e.supportsFroomle,n=e.accountId,o=e.playlistId;return new Promise(function(e){u("Start loading recommendations."),O||(u("Could not load recommendations. Your browser does'nt support 'fetch'."),e([])),t&&E?e(r(E)):n&&o&&e(fetch("https://content.mediahuisvideo.be/playlist/account="+n+"/playlist="+o+"/playlist.json").then(function(e){return u("Static recommendations response was successful."),e.json()}).then(function(e){e=e.items;return e&&8<e.length?e:[]}).then(function(e){return e.map(function(e){var t=e.id,n=e.poster;return{title:e.title,image:n,link:window.location.protocol+"//"+window.location.host+"/videoshare?id="+t}})}).catch(function(e){u("Error while loading the static recommendations.","error",e)})),e([])})},N=function(){return new Promise(function(t){var e=s&&s.items&&s.items.video&&s.items.video.url,n=s&&s.completed,o=1===c.adblock;e||n||o||!i?t(e):i&&(i.subscribe("adv/video/ready",function(e){e=e.url;t(e)}),setTimeout(function(){u("timeout expired; loading video with empty adTag..."),t("")},4e3))}).then(function(e){return u("adTag loaded."),e}).catch(function(e){u("Error while loading adTag.","error",e)})},C=c&&c.features&&c.features.video_enableAutoplay,x="video"===c.article_contenttype,j=function(e,t){var n=e.indexOnPage,e=e.isTheoplayer,t=Math.min.apply(Math,t.map(function(e){return e.indexOnPage}).filter(function(e){return"number"==typeof e}));return C&&x&&e&&n===t};function D(){for(var e,t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return!window.Didomi||(e=(t=window.Didomi.getUserConsentStatusForAll().purposes).enabled,t=t.disabled,e.length)||t.length?Promise.resolve.apply(Promise,o):new Promise(function(e){window.didomiEventListeners.push({event:"consent.changed",listener:function(){e.apply(void 0,o)}})})}var S=["node","videoId"],U=[];function _(){var t,n,o,d=P(),r=d.filter(function(e){return e&&e.isTheoplayer}).filter(function(e){e=e.node;return-1===U.indexOf(e)});if(0<r.length){var e=c.environment&&c.environment.toLowerCase(),i=["test","preview","development"].includes(e);if(!(e||window.location.host&&-1!==window.location.host.indexOf("http")))try{/https?:\/\/(.*?)shared.*/gim.exec(document.querySelector('script[src*="video-theoplayer"]').getAttribute("src"))[1]&&(i=!0)}catch(e){}var e=c.cdn_markupVersion||Math.floor(new Date/864e5),i=(r.filter(function(e){return e.hasRecommendations||e.accountId}).forEach(function(e){e.hasRecommendations&&(t=!0),e.accountId&&(n=e.accountId,o=e.playlistId)}),i?l.CDN_PREVIEW:l.CDN_PRODUCTION),i=p(""+i+l.AGNOPLAY_PATH,e),e=T({supportsFroomle:t,accountId:n,playlistId:o}),a=N().then(D),i=[i,e,a];Promise.all(i).then(function(e){var t=e[1],i=void 0===t?[]:t,a=e[2];return r.forEach(function(e){var t=e.node,n=e.videoId,e=g(e,S),o=(u("Loading video with id: "+n+"."),""),r=document.querySelector('meta[property="og:url"]');r&&(o=r.getAttribute("content")),n?b(Object.assign({},e,{videoId:n,adTag:a,related:i,socialUrl:o,autoplay:j(e,d)})):w(Object.assign({},e,{socialUrl:o,autoplay:j(e,d)})),U.push(t)})}).catch(function(e){u("Error while loading the video player.","error",e)})}}return _(),l.checkUnitializedPlayers=_,l.embedCustomVideo=w,l.embedLiveVideo=w,l.embedVideo=b,l.loadScripts=p,l}({});
//# sourceMappingURL=video-theoplayer.browser.iife.min.js.map
